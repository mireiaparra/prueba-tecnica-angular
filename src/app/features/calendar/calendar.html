<section class="calendar">
  <header class="calendar__header">
    <div class="calendar__nav">
      <i class="pi pi-angle-left icon" (click)="prevMonth()"></i>
      <i class="pi pi-angle-right icon" (click)="nextMonth()"></i>
      <h3>{{ filters.month | capitalize }}</h3>
    </div>

    <div class="calendar__controls">
      <div class="filter">
        <p-multiselect
          [options]="availableCategories"
          [(ngModel)]="filters.category"
          (ngModelChange)="getSessions()"
          [showClear]="true"
          placeholder="CategorÃ­as"
        ></p-multiselect>
      </div>

      <div class="filter">
        <p-multiselect
          [options]="statusOptions"
          [(ngModel)]="filters.status"
          (ngModelChange)="getSessions()"
          [showClear]="true"
          placeholder="Estados"
        ></p-multiselect>
      </div>

      @if(isAdmin) {

      <button class="button" (click)="openCreateModal()">
        <i class="pi pi-plus-circle"></i>
        Crear sesiones
      </button>
      }
    </div>
  </header>

  <div class="calendar__container">
    <div class="calendar__weekdays">
      @for(wd of weekDays; track $index) {
      <div class="weekday">{{ wd | capitalize }}</div>
      }
    </div>
    <div class="calendar__grid">
      @for(d of daysGrid(); track $index) {

      <div class="day" [ngClass]="{ 'other-month past': isPast(d), today: isToday(d) }">
        <div class="day__label">
          {{ d.getDate() }} <span class="day__month">{{ monthShort(d) | capitalize }}</span>
        </div>
        <ul class="day__sessions">
          @if(sessionsForDate(d.toISOString().slice(0,10)).length > 0){
          <li>
            <div
              class="sess"
              [ngClass]="statusClass(sessionsForDate(d.toISOString().slice(0, 10))[0].status)"
              (click)="openCreateModal(sessionsForDate(d.toISOString().slice(0, 10))[0])"
            >
              <span class="sess__bar"></span>
              <span class="sess__time">{{
                sessionsForDate(d.toISOString().slice(0, 10))[0].date.slice(11, 16)
              }}</span>
              <span class="sess__title">{{
                sessionsForDate(d.toISOString().slice(0, 10))[0].title
              }}</span>
              <i
                class="sess__status"
                [ngClass]="statusIcon(sessionsForDate(d.toISOString().slice(0, 10))[0].status)"
                aria-hidden="true"
              ></i>
            </div>
          </li>
          @if(sessionsForDate(d.toISOString().slice(0,10)).length > 1){

          <li class="more">+{{ sessionsForDate(d.toISOString().slice(0, 10)).length - 1 }}</li>
          } }
        </ul>
      </div>
      }
    </div>
  </div>
</section>
